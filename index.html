<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css" rel="stylesheet">
	<link href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" rel="stylesheet" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
	<link href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" rel="stylesheet" />
	<title>AWS-as-infographic</title>

	<style>
		:root {
			--swiper-navigation-sides-offset: -5vw;
		}
		#map {
			height: 100vh;
		}
		#btnFlashCards {
			position: fixed;
			bottom: 5%;
			right: 5%;
			z-index: 999;
		}
		#swiperFlashCards {
			background-color: transparent;
			border: none;
		}
		#btnCloseFlashCards {
			position: fixed;
			top: -2.5em;
			right: 0;
			width: 30px;
			height: 30px;
			background-size: 30px;
			opacity: 1;
		}
		.swiper {
			max-width: 500px;
			max-height: 600px;
			width: 90vw;
			height: 70vh;
		}
		.swiper .card-body {
			height: calc(100% - 102px);
		}
		.prevent-select {
			-webkit-user-select: none; /* Safari */
			-ms-user-select: none; /* IE 10 and IE 11 */
			user-select: none; /* Standard syntax */
		}
		.magic-card {
			border: 2px solid black;
			padding: 10px;
		}
		.magic-card-inner {
			border: 2px solid black;
			border-radius: 0% 7% 0% 40% / 0% 7% 0% 10%; /* https://9elements.github.io/fancy-border-radius/full-control.html#0.0.10.40-90.90.100.100-. */
			height: 100%;
			padding: 0;
			position: relative;
		}
		.magic-card-green {
			background-color: #8EC744;
		}
		.magic-card-green .magic-card-inner::before {
			background-color: #8EC744;
			border-top-color: #8EC744;
			border-left-color: #8EC744;
		}
		.magic-card-green .magic-card-inner::after {
			background-color: #8EC744;
			border-bottom-color: #8EC744;
			border-right-color: #8EC744;
		}
		.magic-card-green .magic-card-header {
			background-color: #BBDD90;
		}
		.magic-card-red {
			background-color: #F0393A;
		}
		.magic-card-red .magic-card-inner::before {
			background-color: #F0393A;
			border-top-color: #F0393A;
			border-left-color: #F0393A;
		}
		.magic-card-red .magic-card-inner::after {
			background-color: #F0393A;
			border-bottom-color: #F0393A;
			border-right-color: #F0393A;
		}
		.magic-card-red .magic-card-header {
			background-color: #F78A83;
		}
		.magic-card-inner::before {
			content: "";
			border: 4px solid transparent;
			border-right: 2px solid black;
			border-bottom: 2px solid black;
			position: absolute;
			top: -3px;
			left: -3px;
			width: 50px;
			height: 50px;
			border-radius: 0% 0% 100% 0% / 0% 0% 100% 0%;
		}
		.magic-card-inner::after {
			content: "";
			border: 4px solid transparent;
			border-left: 2px solid black;
			border-top: 2px solid black;
			position: absolute;
			bottom: -3px;
			right: -3px;
			width: 50px;
			height: 50px;
			border-radius: 20% 0% 0% 0% / 20% 0% 0% 0% ;
		}
		.magic-card-header {
			border-radius: 0% 7% 0% 0% / 0% 70% 0% 0%;
			height: 65px;
			padding-left: 55px;
			padding-top: 10px;
		}
		.magic-card-header .bi {
			margin-right: 10px;
		}
		.magic-card-header .bi {
			color: #F99C59;
			border: 1px solid gray;
			border-radius: 50%;
			padding: 0 3px 1px;
		}
		.magic-card-content {
			background-color: #FAC59D;
			border-top: 2px solid black;
			border-radius: 50% 50% 0% 38% / 5% 5% 0% 11%;
			position: relative;
			top: -5%;
			padding: 5% 10px 10%;
			height: calc(100% - 44px);
		}
		.magic-card-link {
			color: black;
			cursor: pointer;
			font-size: 2.5em;
			position: absolute;
			top: -14px;
			left: -2px;
			z-index: 1;
		}
		.magic-card-answer {
			color: black;
			cursor: pointer;
			font-size: 2.5em;
			position: absolute;
			bottom: -10px;
			right: 0;
			z-index: 1;
		}
	</style>
</head>
<body class="prevent-select">
	<div id="map"></div>
	<svg
		data-src="./infographic/s3-aws-cheatsheet.svg"
		id="infographic"
		oniconload="showLeafLetMap()"
	></svg>

	<div id="btnFlashCards" class="btn-group dropup">
		<button type="button" class="btn btn-info btn-lg" data-bs-toggle="modal" data-bs-target="#modalFlashCards">
			<img src="./images/cards.svg" height="30" alt="Flash cards">
		</button>
		<button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
			<span class="visually-hidden">Toggle Dropdown</span>
		</button>
		<ul class="dropdown-menu">
			<li><button class="dropdown-item btn-lg" data-bs-toggle="modal" data-bs-target="#modalFlashCards" type="button">Practitioner</button></li>
			<li><button class="dropdown-item btn-lg" data-bs-toggle="modal" data-bs-target="#modalFlashCards" type="button">Associate</button></li>
			<li><button class="dropdown-item btn-lg" data-bs-toggle="modal" data-bs-target="#modalFlashCards" type="button">Professional</button></li>
		</ul>
	</div>

	<section id="modalFlashCards" class="modal" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="swiper modal-content" id="swiperFlashCards">
				<div class="swiper-wrapper">
					<article class="magic-card magic-card-green swiper-slide">
						<div class="magic-card-inner">
							<a class="magic-card-link bi bi-link-45deg" href="#"></a>
							<a class="magic-card-answer bi bi-geo-alt-fill" href="#"></a>
							<header class="magic-card-header d-flex justify-content-between">
								<div>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
									<i class="bi bi-star-fill"></i>
								</div>
								<button type="button" class="btn-close btn-lg me-3" data-bs-dismiss="modal" aria-label="Close"></button>
							</header>
							<main class="magic-card-content">
								<h5 class="card-title">Special title treatment</h5>
								<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
								<button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample" aria-expanded="false" aria-controls="collapseWidthExample">
									Hint
								</button>
								<div style="min-height: 50px;">
									<div class="collapse" id="collapseWidthExample">
									<div class="border p-2 mt-2">
										This is some placeholder content for a horizontal collapse. It's hidden by default and shown when triggered.
									</div>
									</div>
								</div>
							</main>
						</div>
					</article>
					<div class="card swiper-slide">
						<div class="card-header">
							Featured #2
						</div>
						<div class="card-body">
							<h5 class="card-title">Special title treatment</h5>
							<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
							<a href="#" class="btn btn-primary">Go somewhere</a>
						</div>
						<div class="card-footer text-body-secondary">
							2 days ago
						</div>
					</div>
					<div class="card swiper-slide">
						<div class="card-header">
							Featured #3
						</div>
						<div class="card-body">
							<h5 class="card-title">Special title treatment</h5>
							<p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
							<a href="#" class="btn btn-primary">Go somewhere</a>
						</div>
						<div class="card-footer text-body-secondary">
							2 days ago
						</div>
					</div>
				</div>
				<div class="swiper-button-prev"></div>
				<div class="swiper-button-next"></div>
			</div>
		</div>
	</section>

	<script src="https://unpkg.com/external-svg-loader@latest/svg-loader.min.js" async></script>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
	<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
	<script src="./scripts/card-renderer.js"></script>
	<script src="./scripts/flashcard-manager.js"></script>
	<script>
		let infographicMap;
		let flashCardModal;
		const mapState = createMapState();

		window.addEventListener("DOMContentLoaded", (event) => {
			const modelElemFlashCards = document.getElementById('modalFlashCards');
			flashCardModal = new bootstrap.Modal(modelElemFlashCards, {
				backdrop: 'static',
			})
			modelElemFlashCards.addEventListener('shown.bs.modal', event => {
				initSwiper();
			});
		});

		function showLeafLetMap() {
			infographicMap = L.map('map', {
				center: [mapState.lat, mapState.lng],
				zoom: mapState.zoom,
				crs: L.CRS.Simple, // https://leafletjs.com/examples/crs-simple/crs-simple.html
			});
			infographicMap
				.on('zoomend', (evt) => {
					mapState.zoom = evt.target.getZoom();
					const queryString = toQueryString(mapState);
					history.replaceState({}, "", `?${queryString}`);
				})
				.on('moveend', (evt) => {
					Object.assign(mapState, evt.target.getCenter());
					const queryString = toQueryString(mapState);
					history.replaceState({}, "", `?${queryString}`);
				})
				.whenReady(() => {
					console.log('Infographic map loaded');
					loadAndRenderCards('/data/s3.js', onShowAnswer)
						.then(newWrapperElem => {
							const swiperFlashCards = document.getElementById('swiperFlashCards');
							const curWrapperElem = swiperFlashCards.querySelector('.swiper-wrapper');
							curWrapperElem.replaceWith(newWrapperElem);
						})
						.catch(console.error);
				});
			
			const svgElement = document.getElementById('infographic');
			const svgElementBounds = [
				[0, 0],
				[100, 100]
			];
			L.svgOverlay(svgElement, svgElementBounds).addTo(infographicMap);

		}
		function initSwiper() {
			const swiper = new Swiper('.swiper', {
				direction: 'horizontal',
				effect: "cards",
				grabCursor: true,
				loop: true,

				// Navigation arrows
				navigation: {
					nextEl: '.swiper-button-next',
					prevEl: '.swiper-button-prev',
				},
			});
		}

		function onShowAnswer(answer) {
			const latlng = L.latLng(answer.lat, answer.lng);
			flashCardModal.hide();
			infographicMap.setView(latlng, answer.zoom, {
				animate: true,
				duration: 1,
			});
		}

		function createMapState() {
			const pageHref = window.location.search; //"?zoom=5&lat=50.515625&lng=30.515625";
			const searchParams = new URLSearchParams(pageHref.substring(pageHref.indexOf('?')));
			return {
				zoom: searchParams.get('zoom') ?? 3,
				lat: searchParams.get('lat') ?? 50,
				lng: searchParams.get('lng') ?? 50,
			};
		}

		function toQueryString(obj) {
			return Object.entries(obj).map(([key, value]) => {
				return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`
			}).join('&');
		}
	</script>
</body>
</html>